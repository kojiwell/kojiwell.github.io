"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8211],{9075:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var l=t(4848),s=t(8453),r=t(4252);const a={id:"kubernetes",title:"Kubernetes - open-source container orchestration system",sidebar_label:"Kubernetes"},i=void 0,o={id:"optional/kubernetes",title:"Kubernetes - open-source container orchestration system",description:"Install Kubernetes on Ubuntu 22.04 machines or VMs in April, 2024",source:"@site/docs/optional/kubernetes.md",sourceDirName:"optional",slug:"/optional/kubernetes",permalink:"/docs/optional/kubernetes",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"kubernetes",title:"Kubernetes - open-source container orchestration system",sidebar_label:"Kubernetes"},sidebar:"notesSidebar",previous:{title:"Docusaurus",permalink:"/docs/optional/docusaurus"},next:{title:"Zsh",permalink:"/docs/optional/zsh"}},d={},c=[{value:"Install Kubernetes on Ubuntu 22.04 machines or VMs in April, 2024",id:"install-kubernetes-on-ubuntu-2204-machines-or-vms-in-april-2024",level:2},{value:"Update and upgrade Ubuntu [ALL]",id:"update-and-upgrade-ubuntu-all",level:3},{value:"Disable swap [ALL]",id:"disable-swap-all",level:3},{value:"Add kernel parameters [ALL]",id:"add-kernel-parameters-all",level:3},{value:"Install Containerd runtime [ALL]",id:"install-containerd-runtime-all",level:3},{value:"Add apt repository for Kubernetes [ALL]",id:"add-apt-repository-for-kubernetes-all",level:3},{value:"Install Kubectl, Kubeadm, and Kubelet [ALL]",id:"install-kubectl-kubeadm-and-kubelet-all",level:3},{value:"Initialize the cluster with Kubeadm [MASTER]",id:"initialize-the-cluster-with-kubeadm-master",level:3},{value:"Install a network plugin &quot;Calico&quot; [MASTER]",id:"install-a-network-plugin-calico-master",level:3},{value:"Add worker nodes [WORKER]",id:"add-worker-nodes-worker",level:3},{value:"Verify the cluster nodes [MASTER]",id:"verify-the-cluster-nodes-master",level:3},{value:"Deploy test application [MASTER]",id:"deploy-test-application-master",level:3},{value:"Tips",id:"tips",level:2},{value:"Mount a local dir",id:"mount-a-local-dir",level:3}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.A,{toc:c}),"\n",(0,l.jsx)(n.h2,{id:"install-kubernetes-on-ubuntu-2204-machines-or-vms-in-april-2024",children:"Install Kubernetes on Ubuntu 22.04 machines or VMs in April, 2024"}),"\n",(0,l.jsxs)(n.p,{children:["This is a bit updated, brief note based on ",(0,l.jsx)(n.a,{href:"https://hbayraktar.medium.com/how-to-install-kubernetes-cluster-on-ubuntu-22-04-step-by-step-guide-7dbf7e8f5f99",children:"How to Install Kubernetes Cluster on Ubuntu 22.04 (Step-by-Step Guide)"}),". You should read it for much better, well-written explanation."]}),"\n",(0,l.jsx)(n.h3,{id:"update-and-upgrade-ubuntu-all",children:"Update and upgrade Ubuntu [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo apt update\nsudo apt upgrade\n"})}),"\n",(0,l.jsx)(n.h3,{id:"disable-swap-all",children:"Disable swap [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo swapoff -a\nsudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab\n"})}),"\n",(0,l.jsx)(n.h3,{id:"add-kernel-parameters-all",children:"Add kernel parameters [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo tee /etc/modules-load.d/containerd.conf <<EOF\noverlay\nbr_netfilter\nEOF\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo modprobe overlay\nsudo modprobe br_netfilter\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo tee /etc/sysctl.d/kubernetes.conf <<EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo sysctl --system\n"})}),"\n",(0,l.jsx)(n.h3,{id:"install-containerd-runtime-all",children:"Install Containerd runtime [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/docker.gpg\nsudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\n\nsudo apt update\nsudo apt install -y containerd.io\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"containerd config default | sudo tee /etc/containerd/config.toml >/dev/null 2>&1\nsudo sed -i 's/SystemdCgroup \\= false/SystemdCgroup \\= true/g' /etc/containerd/config.toml\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo systemctl restart containerd\nsudo systemctl enable containerd\n"})}),"\n",(0,l.jsx)(n.h3,{id:"add-apt-repository-for-kubernetes-all",children:"Add apt repository for Kubernetes [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo apt-get update\nsudo apt-get install -y apt-transport-https ca-certificates curl gpg\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list\n"})}),"\n",(0,l.jsx)(n.h3,{id:"install-kubectl-kubeadm-and-kubelet-all",children:"Install Kubectl, Kubeadm, and Kubelet [ALL]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo apt update\nsudo apt install -y kubelet kubeadm kubectl\nsudo apt-mark hold kubelet kubeadm kubectl\n"})}),"\n",(0,l.jsx)(n.h3,{id:"initialize-the-cluster-with-kubeadm-master",children:"Initialize the cluster with Kubeadm [MASTER]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sudo kubeadm init\n"})}),"\n",(0,l.jsx)(n.p,{children:"To start using your cluster, you need to run the following as a regular user:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,l.jsx)(n.p,{children:"Alternatively, if you are the root user, you can run:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"export KUBECONFIG=/etc/kubernetes/admin.conf\n"})}),"\n",(0,l.jsxs)(n.p,{children:["You should now deploy a pod network to the cluster. Run ",(0,l.jsx)(n.code,{children:"kubectl apply -f [podnetwork].yaml"})," with one of the options listed at ",(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/cluster-administration/addons/",children:"Installing Addons"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"install-a-network-plugin-calico-master",children:'Install a network plugin "Calico" [MASTER]'}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.3/manifests/calico.yaml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"add-worker-nodes-worker",children:"Add worker nodes [WORKER]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubeadm join <ip address>:6443 --token xxxxxx.xxxxxxxxxxxxxxxx \\\n    --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n"})}),"\n",(0,l.jsx)(n.h3,{id:"verify-the-cluster-nodes-master",children:"Verify the cluster nodes [MASTER]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubectl get pods -A\nkubectl get nodes\n"})}),"\n",(0,l.jsx)(n.h3,{id:"deploy-test-application-master",children:"Deploy test application [MASTER]"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# 1. Create an NGINX pod\nkubectl run nginx --image nginx\n\n# 2. Check status\nkubectl get pods --output=wide\n\n# 3. Get a shell in the container\nkubectl exec --stdin --tty nginx -- bash\n\n# 4. Delete the container\nkubectl delete pod nginx\n"})}),"\n",(0,l.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,l.jsx)(n.h3,{id:"mount-a-local-dir",children:"Mount a local dir"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yml"',children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: shell-demo\nspec:\n  volumes:\n  - name: shared-data\n    hostPath:\n      path: /path/to/the/html\n  containers:\n  - name: nginx\n    image: nginx\n    volumeMounts:\n    - name: shared-data\n      mountPath: /usr/share/nginx/html\n    ports:\n    - containerPort: 80\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"tee /path/to/the/html/index.html <<EOF\nHello World!\nEOF\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubectl apply -f deployment.yml\nkubectl exec --stdin --tty mount-demo -- df\nkubectl exec --stdin --tty mount-demo -- cat /usr/share/nginx/html/index.html\nkubectl delete -f deployment.yml\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},4252:(e,n,t)=>{t.d(n,{A:()=>a});t(6540);var l=t(5195);const s={tableOfContentsInline:"tableOfContentsInline_prmo"};var r=t(4848);function a(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:a}=e;return(0,r.jsx)("div",{className:s.tableOfContentsInline,children:(0,r.jsx)(l.A,{toc:n,minHeadingLevel:t,maxHeadingLevel:a,className:"table-of-contents",linkClassName:null})})}},5195:(e,n,t)=>{t.d(n,{A:()=>x});var l=t(6540),s=t(6342);function r(e){const n=e.map((e=>({...e,parentIndex:-1,children:[]}))),t=Array(7).fill(-1);n.forEach(((e,n)=>{const l=t.slice(2,e.level);e.parentIndex=Math.max(...l),t[e.level]=n}));const l=[];return n.forEach((e=>{const{parentIndex:t,...s}=e;t>=0?n[t].children.push(s):l.push(s)})),l}function a(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:l}=e;return n.flatMap((e=>{const n=a({toc:e.children,minHeadingLevel:t,maxHeadingLevel:l});return function(e){return e.level>=t&&e.level<=l}(e)?[{...e,children:n}]:n}))}function i(e){const n=e.getBoundingClientRect();return n.top===n.bottom?i(e.parentNode):n}function o(e,n){let{anchorTopOffset:t}=n;const l=e.find((e=>i(e).top>=t));if(l){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(i(l))?l:e[e.indexOf(l)-1]??null}return e[e.length-1]??null}function d(){const e=(0,l.useRef)(0),{navbar:{hideOnScroll:n}}=(0,s.p)();return(0,l.useEffect)((()=>{e.current=n?0:document.querySelector(".navbar").clientHeight}),[n]),e}function c(e){const n=(0,l.useRef)(void 0),t=d();(0,l.useEffect)((()=>{if(!e)return()=>{};const{linkClassName:l,linkActiveClassName:s,minHeadingLevel:r,maxHeadingLevel:a}=e;function i(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(l),i=function(e){let{minHeadingLevel:n,maxHeadingLevel:t}=e;const l=[];for(let s=n;s<=t;s+=1)l.push(`h${s}.anchor`);return Array.from(document.querySelectorAll(l.join()))}({minHeadingLevel:r,maxHeadingLevel:a}),d=o(i,{anchorTopOffset:t.current}),c=e.find((e=>d&&d.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)));e.forEach((e=>{!function(e,t){t?(n.current&&n.current!==e&&n.current.classList.remove(s),e.classList.add(s),n.current=e):e.classList.remove(s)}(e,e===c)}))}return document.addEventListener("scroll",i),document.addEventListener("resize",i),i(),()=>{document.removeEventListener("scroll",i),document.removeEventListener("resize",i)}}),[e,t])}var u=t(8774),p=t(4848);function h(e){let{toc:n,className:t,linkClassName:l,isChild:s}=e;return n.length?(0,p.jsx)("ul",{className:s?void 0:t,children:n.map((e=>(0,p.jsxs)("li",{children:[(0,p.jsx)(u.A,{to:`#${e.id}`,className:l??void 0,dangerouslySetInnerHTML:{__html:e.value}}),(0,p.jsx)(h,{isChild:!0,toc:e.children,className:t,linkClassName:l})]},e.id)))}):null}const m=l.memo(h);function x(e){let{toc:n,className:t="table-of-contents table-of-contents__left-border",linkClassName:i="table-of-contents__link",linkActiveClassName:o,minHeadingLevel:d,maxHeadingLevel:u,...h}=e;const x=(0,s.p)(),b=d??x.tableOfContents.minHeadingLevel,f=u??x.tableOfContents.maxHeadingLevel,g=function(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:s}=e;return(0,l.useMemo)((()=>a({toc:r(n),minHeadingLevel:t,maxHeadingLevel:s})),[n,t,s])}({toc:n,minHeadingLevel:b,maxHeadingLevel:f});return c((0,l.useMemo)((()=>{if(i&&o)return{linkClassName:i,linkActiveClassName:o,minHeadingLevel:b,maxHeadingLevel:f}}),[i,o,b,f])),(0,p.jsx)(m,{toc:g,className:t,linkClassName:i,...h})}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var l=t(6540);const s={},r=l.createContext(s);function a(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);