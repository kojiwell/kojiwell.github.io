---
id: linux
title: Linux
sidebar_label: Linux
---

Linux is a Unix-based operating system. It's free and open source, and the most widely-used operating system.
Linux inherits the Unix philosophy(minimalist, modular software development) - "do one thing do it well."

## find

Find files owned by user `foo` and change the owner to `bar:group1`

```bash
find /path/to/dir -user foo -exec chown -h bar:group1 {} \;
```

---
List only directories

```bash
find $HOME -maxdepth 1 -type d |tail -n +2 |cut -d '/' -f 3-4
```

* `find $HOME -maxdepth 1 -type d`: Find directories in $HOME. 
  Avoid recursive search, which is the default action of the find command.
* `tail -n +2`: List from the 2nd line. The first line is the current directory, which is the $HOME itself
* `cut -d '/' -f 3-4`: Cut the line by '\', and print from 3rd to 4th

## sed

Replace `foo` with `bar` in a text file

```bash
sed -i.bak 's/foo/bar/g' file.txt

# Ensure the partial words are not matched
sed -i.bak 's/\bfoo\b/bar/g' file.txt
```

* `-i[SUFFIX]`: Edit file in place (make backup if SUFFIX supplied)
* `\b`: word boundary. This ensures the partial words are not matched.

---
Test `sed` before edit a file to ensure the outcome

```bash
echo foo bar foobar barfoo |sed 's/foo/bar/g'                                 
> bar bar barbar barbar

echo foo bar foobar barfoo |sed 's/\bfoo\b/bar/g'
> bar bar foobar barfoo
```
---
Add `prefix_` and/or `_suffix` to every word  in a text

```
# Prefix
echo foo bar | sed 's/\</prefix_/g'
> prefix_foo prefix_bar

# Suffix
echo foo bar | sed 's/\>/_suffix/g'
> foo_suffix bar_suffix

# Prefix and suffix
echo foo bar | sed -e 's/\</prefix_/g' -e 's/\>/_suffix/g'
> prefix_foo_suffix prefix_bar_suffix
```

---
Delete the line that matches the key word

```
seq -f line-'%02g' 10|sed -e '/03/d' -e '/06/d'
```

## rsync

Options I often use

- `--archive, -a` : archive mode
- `--verbose, -v` : increase verbosity
- `--stats` : print a verbose set of statistics on the file transfer
- `--link-dest=/absolute/path/to/dir` : unchanged files are hard linked from `/complete/path/to/dir` to the destination directory
- `--update, -u` : skip files that are newer on the receiver
- `--dry-run, -n` : perform a trial run with no changes made
- `--one-file-system, -x` : don't cross filesystem boundaries
- `--delete` : delete extraneous files from dest dirs
- `--exclude=PATTERN` : exclude files matching PATTERN
- `--exclude-from=FILE` : read exclude patterns from FILE
- `--progress` : show progress during transfer
- `--log-file=FILE` : override the "log file" setting
- `--backup, -b` : make backups
- `--backup-dir=/absolute/path/to/dir/` : make backups into hierarchy based in `/absolute/path/to/dir/`

rsync examples

```
# Sync src to dest and store the differences in src.YYYY-MM-DD
rsync -av --backup --delete --backup-dir=$PWD/src.$(date +%Y-%m-%d)/ src/ dest

# Backup the system partition to /backup directory. (Exclude if /backup is on the system partition.)
rsync -a --stats --one-file-system --exclude=/backup / /backup

# Create a hard linked twin of src as src.YYYY-MM-DD
rsync -a --link-dest=$PWD/src src/ src.$(date +%Y-%m-%d)

# Rsync everything but use hard link if the file is the same as the link-dest. 
# This saves disk space while each of src.YYYY-MM-DD is a complete backup.
rsync -a --link-dest=$PWD/src.YYYY-MM-DD src/ src.$(date +%Y-%m-%d)

# Sync only files and ignore directories
rsync -av --exclude='/*/' src/ dest
```

## script - make typescript of terminal session

```
# Start the script
## newer version (util-linux 2.36.1)
script -a --log-timing log/install_ofed.tm --log-output log/install_ofed.log
## older version (util-linux 2.34)
script -a --timing=log/install_ofed.tm log/install_ofed.log

# Replay it
## newer version
scriptreply --log-timing log/install_ofed.tm --log-output log/install_ofed.log
## older version
scriptreply --timing=log/install_ofed.tm log/install_ofed.log

```
- `-a` : Append the session if the output file exists

Remove special characters in the typescript file generated by the `script` command.
This is helpful when you want to read the file in a text viewer - such as `less`.

``` sh
cat log/install_ofed.log | ansi2txt | iconv | col -b > log/install_ofed.txt
less log/install_ofed.txt
```

## Tips

Show count down in sleep command

``` sh
# 60 seconds
for i in `seq 60 -1 1`; do echo -ne "\r$i "; sleep 1; done
```

